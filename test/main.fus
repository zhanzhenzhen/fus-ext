fus 1.3.1, radical

import "./manifest" all
ass: import "assert"

describe("loop", --
    it("array: number, diamond function", --
        r: []
        ret: loop(5, <> r.push(1))
        ass.deepStrictEqual(r, [1, 1, 1, 1, 1])
        ass.strictEqual(ret, void)
    )

    it("array: number, arrow function", --
        r: []
        loop(5, i -> r.push(i))
        ass.deepStrictEqual(r, [0, 1, 2, 3, 4])
    )

    it("object: by 2 with break", --
        r: []
        loop{1 by 2 for i ->
            r.push i
            if i > 9
                break
        }
        ass.deepStrictEqual(r, [1, 3, 5, 7, 9, 11])
    )

    it("array: number, arrow function with break", --
        r: []
        loop(10, i ->
            r.push(i)
            if i > 5
                break
        )
        ass.deepStrictEqual(r, [0, 1, 2, 3, 4, 5, 6])
    )

    it("object: canonical", --
        r: []
        loop{from: 1, to: 5, for: i ->
            r.push(i)
        }
        ass.deepStrictEqual(r, [1, 2, 3, 4, 5])
    )

    it("object: normal", --
        r: []
        loop{1 to 5 for i ->
            r.push(i)
        }
        ass.deepStrictEqual(r, [1, 2, 3, 4, 5])
    )

    it("object: by -1", --
        r: []
        loop{5 to 1 by -1 for i ->
            r.push(i)
        }
        ass.deepStrictEqual(r, [5, 4, 3, 2, 1])
    )

    it("function: with break", --
        r: []
        loop i ->
            r.push i
            if i > 3
                break
        ass.deepStrictEqual(r, [0, 1, 2, 3, 4])
    )
)

describe("repeat", --
    it("repeat", --
        ass.deepStrictEqual(repeat(5, i -> i + 2), [2, 3, 4, 5, 6])
        ass.deepStrictEqual(repeat(5), [0, 1, 2, 3, 4])
        ass.deepStrictEqual(repeat{1 to 10 by 2}, [1, 3, 5, 7, 9])
        ass.deepStrictEqual(repeat{1 by 2 for i -> i > 9 ? break else i}, [1, 3, 5, 7, 9])
    )
)

describe("enum", --
    it("enum", --
        ass.deepStrictEqual(enum{a}, {a: 0})
        ass.deepStrictEqual(enum{a, b}, {a: 0, b: 1})
    )
)

describe("compose", --
    it("multiple arguments", --
        a: compose(Math.min, Math.abs)
        ass.strictEqual(a(-2, -3), 3)
    )
    it("array argument", --
        a: compose[Math.min, Math.abs]
        ass.strictEqual(a(-2, -3), 3)
    )
)

describe("spread", --
    it("spread", --
        ass.deepStrictEqual(spread(0, 3), [0, 0, 0])
    )
)

describe("eventField", --
    it("eventField", --
        r: null
        Obj: class
            new: --
                me.onClick: eventField()
            makeClick: -- me.onClick.fire()
        obj: Obj()
        obj.onClick(--
            r: true
        )
        obj.makeClick()
        ass.strictEqual(r, true)
    )
)

describe("string", --
    it("format", --
        ass.strictEqual("a {0} b {1}"..format("qq", "r"), "a qq b r")
    )
    it("insert", --
        ass.strictEqual("aaa"..insert(1, "b"), "abaa")
    )
    it("remove", --
        ass.strictEqual("abcde"..remove(1, 2), "ade")
        ass.strictEqual("abcde"..remove(1), "acde")
    )
    it("matches", --
        matches: "aaa bbb"..matches(r"a")
        ass(matches is Array)
        ass.strictEqual(matches.length, 3)
        ass(matches.0 is Array)
        ass.strictEqual(matches.0.length, 1)
        ass.strictEqual(matches.0.0, "a")
        ass.strictEqual(matches.0.index, 0)
        ass(matches.1 is Array)
        ass.strictEqual(matches.1.length, 1)
        ass.strictEqual(matches.1.0, "a")
        ass.strictEqual(matches.1.index, 1)
        ass(matches.2 is Array)
        ass.strictEqual(matches.2.length, 1)
        ass.strictEqual(matches.2.0, "a")
        ass.strictEqual(matches.2.index, 2)
    )
    it("capitalize", --
        ass.strictEqual("abc"..capitalize(), "Abc")
    )
    it("deepSplit", --
        ass.deepStrictEqual("a:b,c:d"..deepSplit(",", ":"), [["a", "b"], ["c", "d"]])
        ass.deepStrictEqual("a:b,c:d"..deepSplit[",", ":"], [["a", "b"], ["c", "d"]])
    )
    it("stripTrailingNewline", --
        ass.strictEqual("a\nb\n"..stripTrailingNewline(), "a\nb")
        ass.strictEqual("a\nb"..stripTrailingNewline(), "a\nb")
    )
    it("ensureTrailingNewline", --
        ass.strictEqual("a\nb\n"..ensureTrailingNewline(), "a\nb\n")
        ass.strictEqual("a\nb"..ensureTrailingNewline(), "a\nb\n")
    )
)

describe("array", --
    it("clone", --
        a: [1, 2, 3]
        b: a..clone()
        ass.notStrictEqual(b, a)
        ass.deepStrictEqual(b, a)
    )
    it("isEmpty", --
        ass.strictEqual([]..isEmpty(), true)
        ass.strictEqual([1]..isEmpty(), false)
    )
    it("portion", --
        ass.deepStrictEqual([1, 2, 3, 4, 5, 6]..portion(2, 3), [3, 4, 5])
        ass.deepStrictEqual([1, 2, 3, 4, 5, 6]..portion(2, void, 3), [3, 4])
        ass.deepStrictEqual([1, 2, 3, 4, 5, 6]..portion(2), [3, 4, 5, 6])
        ass.deepStrictEqual([1, 2, 3, 4, 5, 6]..portion(2, void, 0.999), [3, 4, 5, 6])
    )
    it("at", --
        ass.strictEqual([1, 2, 3, 4, 5]..at(1), 2)
        ass.strictEqual([1, 2, 3, 4, 5]..at(0.5), 3)
    )
    it("atOrNull", --
        ass.strictEqual([1, 2, 3, 4, 5]..atOrNull(1), 2)
        ass.strictEqual([1, 2, 3, 4, 5]..atOrNull(10), null)
    )
    it("atOrVoid", --
        ass.strictEqual([1, 2, 3, 4, 5]..atOrVoid(1), 2)
        ass.strictEqual([1, 2, 3, 4, 5]..atOrVoid(10), void)
    )
    it("includes", --
        ass.strictEqual([1, 2, 3]..includes(3), true)
        ass.strictEqual([1, 2, 3]..includes(4), false)
    )
    it("first", --
        ass.strictEqual([1, 2, 3, 4, 5]..first(), 1)
        ass.strictEqual([1, 2, 3, 4, 5]..first(m -> m mod 2 = 0), 2)
    )
    it("firstOrNull", --
        ass.strictEqual([1, 2, 3, 4, 5]..firstOrNull(m -> m mod 2 = 0), 2)
        ass.strictEqual([1, 2, 3, 4, 5]..firstOrNull(m -> m mod 2 = 2), null)
    )
    it("firstOrVoid", --
        ass.strictEqual([1, 2, 3, 4, 5]..firstOrVoid(m -> m mod 2 = 0), 2)
        ass.strictEqual([1, 2, 3, 4, 5]..firstOrVoid(m -> m mod 2 = 2), void)
    )
    it("last", --
        ass.strictEqual([1, 2, 3, 4, 5]..last(), 5)
        ass.strictEqual([1, 2, 3, 4, 5]..last(m -> m mod 2 = 0), 4)
    )
    it("lastOrNull", --
        ass.strictEqual([1, 2, 3, 4, 5]..lastOrNull(m -> m mod 2 = 0), 4)
        ass.strictEqual([1, 2, 3, 4, 5]..lastOrNull(m -> m mod 2 = 2), null)
    )
    it("lastOrVoid", --
        ass.strictEqual([1, 2, 3, 4, 5]..lastOrVoid(m -> m mod 2 = 0), 4)
        ass.strictEqual([1, 2, 3, 4, 5]..lastOrVoid(m -> m mod 2 = 2), void)
    )
    it("single", --
        ass.throws(-- [1, 2, 3, 4, 5]..single())
        ass.throws(-- [1, 2, 3, 4, 5]..single(m -> m = 10))
        ass.strictEqual([1, 2, 3, 4, 5]..single(m -> m = 3), 3)
    )
    it("singleOrNull", --
        ass.strictEqual([1, 2, 3, 4, 5]..singleOrNull(m -> m = 3), 3)
        ass.strictEqual([1, 2, 3, 4, 5]..singleOrNull(m -> m = 10), null)
    )
    it("singleOrVoid", --
        ass.strictEqual([1, 2, 3, 4, 5]..singleOrVoid(m -> m = 3), 3)
        ass.strictEqual([1, 2, 3, 4, 5]..singleOrVoid(m -> m = 10), void)
    )
    it("withMax", --
        ass.strictEqual([1, 2, 3, 4, 5]..withMax(m -> -m), 1)
        ass.strictEqual([1, 2, 3, 4, 5]..withMax(), 5)
    )
    it("withMin", --
        ass.strictEqual([1, 2, 3, 4, 5]..withMin(m -> -m), 5)
        ass.strictEqual([1, 2, 3, 4, 5]..withMin(), 1)
    )
    it("max", --
        ass.strictEqual([1, 2, 3, 4, 5]..max(m -> -m), -1)
        ass.strictEqual([1, 2, 3, 4, 5]..max(), 5)
    )
    it("min", --
        ass.strictEqual([1, 2, 3, 4, 5]..min(m -> -m), -5)
        ass.strictEqual([1, 2, 3, 4, 5]..min(), 1)
    )
    it("sum", --
        ass.strictEqual([1, 2, 3, 4, 5]..sum(), 15)
    )
    it("average", --
        ass.strictEqual([1, 2, 3, 4, 5]..average(), 3)
    )
    it("median", --
        ass.strictEqual([1, 2, 3, 4, 10]..median(), 3)
        ass.strictEqual([1, 2, 3, 4, 5, 10]..median(), 3.5)
    )
    it("product", --
        ass.strictEqual([1, 2, 3, 4, 5]..product(), 120)
    )
    it("group", --
        ass.deepStrictEqual([1, 2, 3, 4, 5, 6]..group(m -> m mod 2), [
            [0, [2, 4, 6]]
            [1, [1, 3, 5]]
        ])
    )
    it("sort", --
        ass.deepStrictEqual([2, 4, 3, 5, 1]..sort(), [1, 2, 3, 4, 5])
        ass.deepStrictEqual([2, 4, 3, 5, 1]..sort(m -> -m), [5, 4, 3, 2, 1])
    )
    it("sortDescending", --
        ass.deepStrictEqual([2, 4, 3, 5, 1]..sortDescending(), [5, 4, 3, 2, 1])
        ass.deepStrictEqual([2, 4, 3, 5, 1]..sortDescending(m -> -m), [1, 2, 3, 4, 5])
    )
    it("reverse", --
        ass.deepStrictEqual([1, 2, 3, 4, 5]..reverse(), [5, 4, 3, 2, 1])
    )
    it("except", --
        ass.deepStrictEqual([1, 2, 3, 4, 5]..except([3]), [1, 2, 4, 5])
    )
    it("distinct", --
        ass.deepStrictEqual([1, 2, 2, 3, 3]..distinct(), [1, 2, 3])
    )
    it("union", --
        ass.deepStrictEqual([1, 2, 3]..union([4, 5]), [1, 2, 3, 4, 5])
    )
    it("intersect", --
        ass.deepStrictEqual([1, 2, 3]..intersect([2, 3, 4, 5]), [2, 3])
        ass.deepStrictEqual([1, 2, 3]..intersect([4, 5]), [])
    )
    it("flatten", --
        ass.deepStrictEqual([1, [[2, 3], 4], 5]..flatten(), [1, 2, 3, 4, 5])
        ass.deepStrictEqual([1, [[2, 3], 4], 5]..flatten(1), [1, [2, 3], 4, 5])
    )
    it("toObject", --
        ass.deepStrictEqual([["a", 1], ["b", 2]]..toObject(), {a: 1, b: 2})
    )
    it("deepJoin", --
        ass.strictEqual([["a", "b"], ["c", "d"]]..deepJoin(":", ","), "a:b,c:d")
        ass.strictEqual([["a", "b"], ["c", "d"]]..deepJoin[":", ","], "a:b,c:d")
    )
    it("randomOne", --
        arr: [1, 2, 3, 4, 5, 6, 7, 8, 9]
        r: repeat(20, <> arr..randomOne())
        ass(r..distinct().length > 1)
    )
)
